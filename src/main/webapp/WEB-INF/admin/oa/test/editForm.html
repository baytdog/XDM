	
	<div id="page-content">
			<div class="col-lg-12">
		        <div class="panel">
		            <div class="panel-heading">
		                <h3 class="panel-title" style="text-align: center;">
		                 测试/调查
		                </h3>
		            </div>
		            <form id="editForm" class="panel-body form-horizontal form-padding">
		            	<input  id="infoid" type="hidden" name="oaShowinfo.id" value="#(o?o.id:'')">
		             
		            	<div class="form-group">
		                    <label class="col-md-2 control-label">名称</label>
		                    <div class="col-md-9">
				                <input type="text"  name="oaTest.testname" class="form-control"  value="#(o?o.testname:'')" #if(view=="detail") readonly #end />
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-2 control-label">总分</label>
		                    <div class="col-md-9">
		                        <input type="text"  name="oaTest.score" class="form-control"  value="#(o?o.score:'')" #if(view=="detail") readonly #end />
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-2 control-label">时长</label>
		                    <div class="col-md-9">
		                        <input type="text"  name="oaTest.testdatetime" class="form-control"  value="#(o?o.testdatetime:'')" #if(view=="detail") readonly #end />
		                    </div>
		                </div>
			           
		            </form>
		            
		             <div class="panel-heading">
		                <h3 class="panel-title" style="text-align: center;">
		                 测试/调查问题
		                </h3>
		            </div>
		            <form id="editForm1" class="panel-body form-horizontal form-padding">
		            	<input  id="infoid1" type="hidden" name="oaQuestions.id" value="#(oq?o.id:'')">
		            	<input  id="testid" type="hidden" name="oaQuestions.testid" value="#(o?o.id:'')">
		             
		            	<div class="form-group">
		                    <label class="col-md-2 control-label">问题</label>
		                    <div class="col-md-9">
				                <input  id="testquestion" type="text"  name="oaQuestions.testquestion" class="form-control"  value="#(oq?oq.testquestion:'')"  />
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-2 control-label">正确答案</label>
		                  <!--   <div class="col-md-9">
		                        <input type="text"  name="oaQuestions.qanswer" class="form-control"  value="#(oq?oq.qanswer:'')"   />
		                    </div> -->
		                    
		                     <div class="col-md-9" style="line-height: 30px;">
		                     <select id="qanswer" name="oaQuestions.qanswer"  value="#(oq?oq.qanswer:'')"   title="请选择正确答案"  class="selectpicker show-tick form-control" actionsBox="true"  multiple data-live-search="false">
									     <option value="A">A</option>
									     <option value="B">B</option>
									     <option value="C">C</option>
									     <option value="D">D</option>
                                </select>
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-2 control-label">分值</label>
		                    <div class="col-md-9">
		                        <input  id="qscore" type="text"  name="oaQuestions.qscore" class="form-control"  value="#(oq?oq.qscore:'')"  />
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-2 control-label">排序号</label>
		                    <div class="col-md-9">
		                        <input   id="sortnum" type="text"  name="oaQuestions.sortnum" class="form-control"  value="#(oq?oq.sortnum:'')"  />
		                    </div>
		                </div>
			           
			                 <div class="panel-footer">
			                    <div class="row" align="center">
			                        <div class="col-sm-12 ">
			                         	<button class="btn btn-primary" onclick="window.history.back();" type="reset">返回</button>
			                            
			                           
			                            <button class="btn btn-primary" type="button" onclick="doSave()" >保存</button>
			                           
 		                       
 									 </div>
			                    </div>
			                </div>
			           
		            </form>
		            
		            
		            	<div class="panel-body">
								 
									<table id="pageTable" class="demo-add-niftycheck" data-toolbar="#del,#add,#addq"
										   data-search="true"
										   data-show-refresh="true"
										   data-show-toggle="true"
										   data-show-columns="true"
										   data-sort-name="id"
										   data-page-list="[5, 10, 20]"
										   data-page-size="5"
										   data-pagination="true" data-show-pagination-switch="true" ></table>
						 </div>
						 
						 
						 <div class="panel-heading">
		                <h3 class="panel-title" style="text-align: center;">
		                问题选项
		                </h3>
		            </div> 
					  <form id="editForm2" class="panel-body form-horizontal form-padding">
		            	<input  id="infoid2" type="hidden" name="oaQchoice.id" value="#(oqc?oqc.id:'')">
		            	<input  id="qtestid" type="hidden" name="oaQchoice.tid" value="#(o?o.id:'')">
		            	<input  id="qid" type="hidden" name="oaQchoice.qid" value="#(oqc?oqc.qid:'')">
		             
		       
		                
		                   <div class="form-group">
		                    <label class="col-md-2 control-label">选项</label>
		                  <!--   <div class="col-md-9">
		                        <input type="text"  name="oaQuestions.qanswer" class="form-control"  value="#(oq?oq.qanswer:'')"   />
		                    </div> -->
		                    
		                     <div class="col-md-9" style="line-height: 30px;">
		                     <select id="qchoice" name="oaQchoice.qchoice"  value="#(oqc?oqc.qchoice:'')"   title="请选择选项"  class="selectpicker show-tick form-control" actionsBox="true"   data-live-search="false">
									     <option value="A">A</option>
									     <option value="B">B</option>
									     <option value="C">C</option>
									     <option value="D">D</option>
                                </select>
		                    </div>
		                </div>
		                <div class="form-group">
		                    <label class="col-md-2 control-label">选项内容</label>
		                    <div class="col-md-9">
		                        <input  id="qchoicecontent" type="text"  name="oaQchoice.qchoicecontent" class="form-control"  value="#(oqc?oqc.qchoicecontent:'')"  />
		                    </div>
		                </div>
		              
			           
			                 <div class="panel-footer">
			                    <div class="row" align="center">
			                        <div class="col-sm-12 ">
			                         	<button class="btn btn-primary" onclick="window.history.back();" type="reset">返回</button>
			                            
			                           
			                            <button class="btn btn-primary" type="button" onclick="doSaveChoice()" >保存</button>
			                           
 		                       
 									 </div>
			                    </div>
			                </div>
			           
		            </form>	 
						 
							<div  id="chioceT" class="panel-body">
								 
									<table id="pageTableC" class="demo-add-niftycheck" data-toolbar="#del,#add,#addq"
										   data-search="true"
										   data-show-refresh="true"
										   data-show-toggle="true"
										   data-show-columns="true"
										   data-sort-name="id"
										   data-page-list="[5, 10, 20]"
										   data-page-size="5"
										   data-pagination="true" data-show-pagination-switch="true" ></table>
						 </div> 
		        </div>
	</div>
	<script>
		function save(){
			var data = common_ajax.ajaxFunc("/admin/oa/test/saveQ", $('#editForm1').serialize(), "json", null);
			if(data.success){
				pointLion.alertMsg("保存成功!" , "success" , "small" , function(){
					//location.href = ctx+'/admin/oa/test/getListPage';//跳转到列表页
					
					// busid=data.data.id;
					
					 $('#infoid1').val('');
	                  //$('#testid').val(row.testid)
	                  $('#testquestion').val('');
	                  $('#qanswer').val('');
	                  
			        var qanswer=new Array();
	                  
						 $('#qanswer').selectpicker('val',qanswer).trigger("change");  
	                  $('#qscore').val('');
	                  $('#sortnum').val(''); 
	               
					
					
					searchTable();
					
				},data);
			}else{
				pointLion.alertMsg(data.message , "danger" , "small" , function(){
					$(".btn").removeAttr("disabled");
				},data);
			}
		}
		function doSaveChoice(){
			var data = common_ajax.ajaxFunc("/admin/oa/test/saveQC", $('#editForm2').serialize(), "json", null);
			if(data.success){
				pointLion.alertMsg("保存成功!" , "success" , "small" , function(){
					//location.href = ctx+'/admin/oa/test/getListPage';//跳转到列表页
					
					// busid=data.data.id;
					
					
					searchTableC()
					
				  $('#infoid2').val('');
	           
	                  $('#testquestion').val('');
	                  $('#qanswer').val('');
	                  
			        var qchoice=new Array();
	                  
					  $('#qchoice').selectpicker('val',qchoice).trigger("change");  
	                  $('#qchoicecontent').val('');
	               
					
					
					//searchTable();
					
				},data);
			}else{
				pointLion.alertMsg(data.message , "danger" , "small" , function(){
					$(".btn").removeAttr("disabled");
				},data);
			}
		}
		//表单校验
		function formValidate(){
			$('#editForm').bootstrapValidator({
	    		excluded:[":disabled"],
	            fields: {
	            	"oaNotice.title": {
	                    validators: {
	                        notEmpty: {
	                            message: '*公文标题不能为空'
	                        },
	                        stringLength: {
	                            max: 50,
	                            message: '*公文标题长度必须小于50'
	                        }
	                    }
	                },
	                "oaNotice.to_org_id":{
	                	validators: {
	                        notEmpty: {
	                            message: '*公文标题不能为空'
	                        }
	                    }
	                }
	            }
	        }).bootstrapValidator('validate');
		}
		//进行保存
		function doSave(){
			var content = $("#demo-summernote").summernote('code');
			$("#content").val(content);
			var validator = formValidate();//表单校验
			var va = $("#editForm").data('bootstrapValidator').isValid();
			if(va){
				save();
			}
		}
		//选择通知到单位
		function selectManyOrg(){
			pointLion.selectManyOrg(function(orgNode){
				var orgidArr = [];
				var orgnameArr = [];
				$.each(orgNode,function(i,d){
					orgidArr.push(d.id);
					orgnameArr.push(d.name);
				});
				$("#toOrgid").val(orgidArr.join(","));
				$("#toOrgName").val(orgnameArr.join(","));
				//重新校验
				if($("#editForm").data('bootstrapValidator')){
					$("#editForm").data('bootstrapValidator').destroy();
			        $('#editForm').data('bootstrapValidator', null);
				}
		        formValidate();
			});
		}
		//页面初始化
		$(document).ready(function() {
			$('#demo-summernote').summernote({
				toolbar: [    
							['style', ['style','bold', 'italic', 'underline', 'clear']],
						    ['font', ['strikethrough', 'superscript', 'subscript']],
						    ['fontname', ['fontname']],
						    ['fontsize', ['fontsize']],
						    ['color', ['color']],
						    ['para', ['ul', 'ol', 'paragraph']],
						    ['height', ['height']],
						    ['table', ['table']],
						    ['insert', ['link', 'picture', 'video']],
						    ['view', ['codeview','fullscreen']]
				      ],
				lang : 'zh-CN',
				dialogsFade : true,
				dialogsInBody : true,
				disableDragAndDrop : false,
				minHeight : '300px'
			 
			 
		    });
			var type="#(view)";
			if(type=="detail"){
				$('#demo-summernote').summernote('disable');
			}
		});
		
		
		
		
		
		
		function initSelectOptions(selectId, parentId) {
			var selectObj = $("#" + selectId);
			$.ajax({
		        url : "getSecondMenu?parentid="+parentId,
		        async : false,
		        type : "GET",
		        success : function(result) {
		        	if (result.success) {
		        		var configs = result.data;
		        		selectObj.find("option:not(:first)").remove();
		        		for (var i in configs) {
		        			var addressConfig = configs[i];
		        			var optionValue = addressConfig.id;
		        			var optionText = addressConfig.menuname;	
		        			selectObj.append(new Option(optionText, optionValue));
		        		}
		        		
		        		// 刷新select
		    			selectObj.selectpicker('refresh');
		        	} else {
		        		toastr.error('获取['+ parentId + ']信息失败，原因：' + result.errorMessage);
		        	}
		        },
		        error : function(result) {
		        	toastr.error('获取['+ parentId + ']信息失败，原因：' + result.errorMessage);
		        }
			});// ajax
		}

		
		
		
		/**
		 * 根据选择的省份动态初始化城市options
		 * @returns
		 */
		function initSecondMenu() {
			// 当省份变动时，初始化城市和清空县区和街道
			var firstmenuSel = $("#firstmenu").val();
			initSelectOptions("secondmenu", firstmenuSel);
			$("#region").find("option:not(:first)").remove();
			$("#region").selectpicker('refresh');
			$("#street").find("option:not(:first)").remove();
			$("#street").selectpicker('refresh');
		}
		
		var view = "#(view?view:'')";
		var  busid=$("#infoid").val();
		function doUploadAttachment(){
			
			if(busid){
				pointLion.openBusinessAttachmentPage(busid,view,function(){
					
					setAttachmentCount();//关闭之后回调
				});
			}else{
				pointLion.alertMsg("请先保存再上传附件！" , "danger" , "small" , null);
			}
		}
		//设置附件数量
		function setAttachmentCount(){
			var data = common_ajax.ajaxFunc("/admin/sys/attachment/getBusinessAttachmentCount", {"busid":busid}, "json", null);
			if(data.success){
				$("#businessAttachmentCount").html(data.data);
			}
		}
		
		
		function  secondMenuChange(){
			 $("#secondmenu").val();
			 
			 $("#menuid").val( $("#secondmenu").val());
			
		}
		
		
		
		
		
		function openSlectCostOneUser(sp){
			pointLion.selectManyUser("orgid="+encodeURIComponent("root"),$("#flowCCId").val(),function(data){
				if(sp=="1"){
					$("#testersids").val(data.idData);
					$("#testers").val(data.nameData);
				}
				if(sp=="2"){
					$("#ccid").val(data.idData);
					$("#cc").val(data.nameData);
				}
				if(sp=="3"){
					$("#dcid").val(data.idData);
					$("#dc").val(data.nameData);
				}
				
			});
		}
		
		//表格
		function initTable(){
			$('#pageTable').bootstrapTable(opt);
			$('#pageTable').bootstrapTable('hideColumn', 'id');
			$('#pageTableC').bootstrapTable(optc);
			$('#pageTableC').bootstrapTable('hideColumn', 'id');
		}
		function refreshTable(){
			$("#pageTable").bootstrapTable('refresh', opt);
			$('#pageTable').bootstrapTable('hideColumn', 'id');
		}
		
		//表格
		/* function initTable(){
			$('#pageTableC').bootstrapTable(opt);
			$('#pageTableC').bootstrapTable('hideColumn', 'id');
		} */
		function refreshTable(){
			$("#pageTableC").bootstrapTable('refresh', opt);
			$('#pageTableC').bootstrapTable('hideColumn', 'id');
		}
		
		
		
		//查询
		function searchTable(){
			var tid = $("#infoid").val();
			var param = {
				query: {
					"tid":tid
				}
			}
			// 刷新表格
			$('#pageTable').bootstrapTable('refresh',param);
		}
		
		
		function searchTableC(){
			var qid = $("#qid").val();
			var param = {
				query: {
					"qid":qid
				}
			}
			// 刷新表格
			$('#pageTableC').bootstrapTable('refresh',param);
		}

		var col = [
			
			/* 	{field: 'checked', radio : true, align: 'center'}, */
			   {field: 'testquestion', title: '问题', align: 'center'},
			   {field: 'qanswer', title: '正确答案', align: 'center'},
			   {field: 'qscore', title: '问题分数', align: 'center'},
			   {field: 'sortnum', title: '排序号', align: 'center'},
		   
		   
		   {field: 'control', title: '操作', align: 'left', width:'200',
		       formatter:function(value,row,index){
		           	 
		         	var a ='<a class="label label-table label-danger" onclick="del(\''+row.id+'\')" href="javascript:void(0);" >删除</a>';
		           	return a;
		       }
		   }];
		
var colc = [
			
			/* 	{field: 'checked', radio : true, align: 'center'}, */
			   {field: 'qchoice', title: '选项', align: 'center'},
			   {field: 'qchoicecontent', title: '选项内容', align: 'center'},
		   
		   {field: 'control', title: '操作', align: 'left', width:'200',
		       formatter:function(value,row,index){
		           	 
		         	var a ='<a class="label label-table label-danger" onclick="del(\''+row.id+'\')" href="javascript:void(0);" >删除</a>';
		           	return a;
		       }
		   }];
		var opt = {
			    //请求方法
				   method: 'get',
				    //是否显示行间隔色
				   striped: true,
				   //是否使用缓存，默认为true，所以一般情况下�?要设置一下这个属性（*�?     
				   cache: false,  
				   //data-toolbar: "#demo-delete-row",
				   //是否显示分页�?*�?  
				   pagination: true,   
				    //是否启用排序  
				   sortable: false,    
				    //排序方式 
				   sortOrder: "asc",    
				   //初始化加载第�?页，默认第一�?
				   //我设置了这一项，但是貌似没起作用，�?�且我这默认�?0,- -
				   //pageNumber:1,   
				   //每页的记录行数（*�?   
				   pageSize: 10,  
				   //可供选择的每页的行数�?*�?    
				   pageList: [10, 25, 50, 100],
				   //这个接口�?要处理bootstrap table传�?�的固定参数,并返回特定格式的json数据  
				   url: ctx+"/admin/oa/test/listQData?tid="+$("#infoid").val(),
				   //默认值为 'limit',传给服务端的参数为：limit, offset, search, sort, order Else
				   //queryParamsType:'',   
				   ////查询参数,每次调用是会带上这个参数，可自定�?                         
				   queryParams : function(params) {
				       return {
				             pageNumber: (params.offset/params.limit)+1,
				             pageSize: params.limit
				           };
				   },
				   onClickRow:function (row,$element) {
	                  $('#infoid1').val(row.id)
	                  $('#testid').val(row.testid)
	                  $('#testquestion').val(row.testquestion)
	                  $('#qanswer').val(row.qanswer)
	                  
			          var qanswer=new Array();
	                  qanswer=row.qanswer.split(",");
						 $('#qanswer').selectpicker('val',qanswer).trigger("change"); 
	                  $('#qscore').val(row.qscore);
	                  $('#sortnum').val(row.sortnum) ;
	               
	                 // searchTableC();
	                 
	                 	$("#editForm2").show();
						$("#chioceT").show();
						$("#qid").val(row.id);
						$("#qtestid").val(row.testid);
	                 
	              	var param = {
	        				query: {
	        					"qid":row.id
	        				}
	        			}
	        			// 刷新表格
	        			$('#pageTableC').bootstrapTable('refresh',param);
	                },
				   //分页方式：client客户端分页，server服务端分页（*�?
				   sidePagination: "server",
				   //是否显示搜索
				   search: false,  
				   //Enable the strict search.    
				   strictSearch: true,
				   //Indicate which field is an identity field.
				   idField : "id",
				   columns: col,
				   pagination:true,paginationShowPageGo: true
				}; 
			
		
		var optc = {
			    //请求方法
				   method: 'get',
				    //是否显示行间隔色
				   striped: true,
				   //是否使用缓存，默认为true，所以一般情况下�?要设置一下这个属性（*�?     
				   cache: false,  
				   //data-toolbar: "#demo-delete-row",
				   //是否显示分页�?*�?  
				   pagination: true,   
				    //是否启用排序  
				   sortable: false,    
				    //排序方式 
				   sortOrder: "asc",    
				   //初始化加载第�?页，默认第一�?
				   //我设置了这一项，但是貌似没起作用，�?�且我这默认�?0,- -
				   //pageNumber:1,   
				   //每页的记录行数（*�?   
				   pageSize: 10,  
				   //可供选择的每页的行数�?*�?    
				   pageList: [10, 25, 50, 100],
				   //这个接口�?要处理bootstrap table传�?�的固定参数,并返回特定格式的json数据  
				   url: ctx+"/admin/oa/test/listCData",
				   //默认值为 'limit',传给服务端的参数为：limit, offset, search, sort, order Else
				   //queryParamsType:'',   
				   ////查询参数,每次调用是会带上这个参数，可自定�?                         
				   queryParams : function(params) {
				       return {
				             pageNumber: (params.offset/params.limit)+1,
				             pageSize: params.limit
				           };
				   },
				   onClickRow:function (row,$element) {
	               /*    $('#infoid1').val(row.id)
	                  $('#testid').val(row.testid)
	                  $('#testquestion').val(row.testquestion)
	                  $('#qanswer').val(row.qanswer)
	                  
			          var qanswer=new Array();
	                  qanswer=row.qanswer.split(",");
						 $('#qanswer').selectpicker('val',qanswer).trigger("change"); 
	                  $('#qscore').val(row.qscore)
	                  $('#sortnum').val(row.sortnum)  */
	               
					 
	                },
				   //分页方式：client客户端分页，server服务端分页（*�?
				   sidePagination: "server",
				   //是否显示搜索
				   search: false,  
				   //Enable the strict search.    
				   strictSearch: true,
				   //Indicate which field is an identity field.
				   idField : "id",
				   columns: colc,
				   pagination:true,paginationShowPageGo: true
				}; 
			
		
		
		//删除
		function del(id){
			pointLion.confimMsg("您是否要删除该条记录<br/> 点击确认进行删除 , 点击取消取消该操作",null,function(){
				//执行删除
				var data = common_ajax.ajaxFunc("/admin/oa/test/deleteQ",{"ids":id}, "json", null);
				//删除结果
				if(data.success){
					pointLion.alertMsg(data.message,"success",null,function(){
						//location.href = ctx+'/admin/test/getListPage';//跳转到列表页
						searchTable();
					});
				}else{
					pointLion.alertMsg(data.message,"success",null,null);
				}
			});
		};
		
		
		$('#depart').on('changed.bs.select', function (e) {
			
			
			$('#testdepartementsids').val($('#depart').val())
		}); 
		
		
		
		
		function editrowinfo(row){
			alert(row.id);
			alert(row.testquestion);
		}
		
		$(function(){
			
			
			 #if(view=="detail") 
				  $('#depart').selectpicker('setStyle', 'disabled', 'add');  
				  $('#testtype').selectpicker('setStyle', 'disabled', 'add');  
			 
			 #end
			 
			 #if(o.testdepartementsids)
				 
				 var olddepart=new Array();
				 olddepart="#(o.testdepartementsids)".split(",");
				 $('#depart').selectpicker('val',olddepart).trigger("change"); 
			 #end
			 
			#if(o.testtype)
				
				 $('#testtype').selectpicker('val',#(o.testtype)).trigger("change"); 
			#end	
			 
			
			#if(view=="edit" ||view=="detail")
		 	 $('#firstmenu').selectpicker('val','#(firstMenuId)').trigger("change");
			
			 $('#secondmenu').selectpicker('val','#(o.menuid)').trigger("change");
			 #end
			 
			 initTable();//初始化表格
			// initTableC();//初始化表格
			
			$("#editForm2").hide();
			$("#chioceT").hide();
		});
		
	</script>