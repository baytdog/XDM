<link href="#(ctx)/common/plugins/jquery-ui/scripts/miniui/themes/default/miniui.css" rel="stylesheet"/>
<div id="page-content">
			<div class="col-lg-12">
		        <div class="panel">
					#include("editForm.html")
		        </div>
		    </div>
	</div>


	<script>
		function save(){
			let gridData1 = grid.getData();
			let gridData2 = grid2.getData();
			console.log(gridData1);
			console.log(gridData2);
			console.log(mini.decode(gridData1));

			var data = common_ajax.ajaxFunc("/admin/xd/xdemployee/save",$('#editForm').serialize()+"&gridData1="+mini.encode(gridData1)+"&gridData2="+mini.encode(gridData2), "json", null);
			if(data.success){
				pointLion.alertMsg("操作成功!" , "success" , "small" , function(){
					location.href = ctx+'/admin/xd/xdemployee/getListPage';//跳转到列表页
				},data);
			}else{
				pointLion.alertMsg(data.message , "danger" , "small" , function(){
					$(".btn").removeAttr("disabled");
				},data);
			}
		}
		$(document).ready(function() {
			$('#editForm').bootstrapValidator({
	            fields: {
	            }
	        }).on("success.form.bv", function (e) {
	            save();
	            return false;//阻止表单跳转
	        });
		});
	</script>

<!--	<link href="#(ctx)/common/plugins/jquery-ui/scripts/miniui/themes/default/miniui.css" rel="stylesheet" type="text/css" />-->

	<script type="text/javascript">

		// var Genders = [{ id: 1, text: '男' }, { id: 2, text: '女'}];

		mini.parse();

		var grid = mini.get("datagrid1");
		var grid2 = mini.get("datagrid2");


		/*function  ttt(){
			console.log("1111")
			console.log(grid.getData())
		}*/

		//var menu = new ColumnsMenu(grid);

		function addRow1() {
			var newRow = { name: "New Row",id:"",enrolldate:"" ,graduatdate:"",trainOrgname:"",major:"",edubg:""};
			grid.addRow(newRow, 0);

			grid.beginEditCell(newRow, "enrolldate");
		}
		function addRow2() {
			var newRow = { name: "New Row",id:"",entrydate:"" ,departdate:"",serviceunit:"",job:"",addr:""};
			grid2.addRow(newRow, 0);

			grid2.beginEditCell(newRow, "entrydate");
		}
		function removeRow1() {
			var rows = grid.getSelecteds();
			if (rows.length > 0) {
				grid.removeRows(rows, true);
			}
		}
		function removeRow2() {
			var rows = grid2.getSelecteds();
			if (rows.length > 0) {
				grid2.removeRows(rows, true);
			}
		}
		// function saveData() {
		//
		// 	saveGrid(grid, {
		// 		url: "../data/AjaxService.aspx?method=SaveEmployees"
		// 	});
		//
		// }


		grid.on("celleditenter", function (e) {
			var index = grid.indexOf(e.record);
			if (index == grid.getData().length - 1) {
				var row = {};
				grid.addRow(row);
			}
		});
		grid2.on("celleditenter", function (e) {
			var index = grid2.indexOf(e.record);
			if (index == grid2.getData().length - 1) {
				var row = {};
				grid2.addRow(row);
			}
		});

		grid.on("beforeload", function (e) {
			if (grid.getChanges().length > 0) {
				if (confirm("有增删改的数据未保存，是否取消本次操作？")) {
					e.cancel = true;
				}
			}
		});
		grid2.on("beforeload", function (e) {
			if (grid2.getChanges().length > 0) {
				if (confirm("有增删改的数据未保存，是否取消本次操作？")) {
					e.cancel = true;
				}
			}
		});
	</script>
	<script>

		$(function(){
			//alert("123")
			var employeeId=$("#employeeId").val();
			console.log(employeeId);
			console.log(grid.getData())
			var data = common_ajax.ajaxFunc("/admin/xd/xdedutrain/getEduTrainList", {"employeeId":employeeId}, "json", null);

			grid.setData(data);
			data = common_ajax.ajaxFunc("/admin/xd/xdworkexper/getWorkExperList", {"employeeId":employeeId}, "json", null);

			grid2.setData(data);
			// if(data.success){
			// 	$("#businessAttachmentCount").html(data.data);
			// }
		});

	</script>

